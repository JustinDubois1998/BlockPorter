<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlockPorter - –í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword,
            GoogleAuthProvider,
            signInWithPopup,
            sendPasswordResetEmail,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDW9qARQxPZQOQPsehi3VkpG9dhHhnysO8",
            authDomain: "crosshain-swap.firebaseapp.com",
            projectId: "crosshain-swap",
            storageBucket: "crosshain-swap.firebasestorage.app",
            messagingSenderId: "686655052904",
            appId: "1:686655052904:web:70a0de0063d9ce82f7afdd"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // –ï—Å–ª–∏ —É–∂–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω ‚Äî –Ω–∞ dashboard
        onAuthStateChanged(auth, user => {
            if (user) {
                window.location.href = 'dashboard.html';
            }
        });

        // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(show) {
            document.getElementById('loading-spinner').style.display = show ? 'block' : 'none';
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è email/password
        document.getElementById('register-form')?.addEventListener('submit', e => {
            e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;
            showLoading(true);
            createUserWithEmailAndPassword(auth, email, password)
                .then(() => {
                    alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! üöÄ');
                    window.location.href = 'dashboard.html';
                })
                .catch(err => {
                    alert('–û—à–∏–±–∫–∞: ' + err.message);
                })
                .finally(() => showLoading(false));
        });

        // –í—Ö–æ–¥ email/password
        document.getElementById('login-form')?.addEventListener('submit', e => {
            e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;
            showLoading(true);
            signInWithEmailAndPassword(auth, email, password)
                .then(() => window.location.href = 'dashboard.html')
                .catch(err => alert('–û—à–∏–±–∫–∞: ' + err.message))
                .finally(() => showLoading(false));
        });

        // –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
        document.getElementById('google-btn')?.addEventListener('click', () => {
            showLoading(true);
            signInWithPopup(auth, provider)
                .then(() => window.location.href = 'dashboard.html')
                .catch(err => alert('–û—à–∏–±–∫–∞ Google –≤—Ö–æ–¥–∞: ' + err.message))
                .finally(() => showLoading(false));
        });

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
        document.getElementById('reset-form')?.addEventListener('submit', e => {
            e.preventDefault();
            const email = e.target.resetEmail.value;
            showLoading(true);
            sendPasswordResetEmail(auth, email)
                .then(() => alert('–ü–∏—Å—å–º–æ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ' + email))
                .catch(err => alert('–û—à–∏–±–∫–∞: ' + err.message))
                .finally(() => {
                    showLoading(false);
                    document.getElementById('reset-modal').style.display = 'none';
                });
        });
    </script>
</head>
<body>
    <!-- –ï–¥–∏–Ω–∞—è —à–∞–ø–∫–∞ —Å –Ω–æ–≤—ã–º –ª–æ–≥–æ—Ç–∏–ø–æ–º -->
    <header>
        <div class="container">
            <a href="index.html" class="logo">
                <img src="logo.svg" alt="BlockPorter" height="40">
            </a>
        <nav>
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="dashboard.html">–û–±–º–µ–Ω</a>
            <a href="about.html">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
            <span id="user-info"><a href="auth.html">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></span>
        </nav>
        </div>
    </header>

    <main class="container auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <i class="fas fa-portal-enter auth-icon"></i> <!-- –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ fa-exchange-alt -->
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h2>
                <p>–ö—Ä–æ—Å—Å—á–µ–π–Ω –æ–±–º–µ–Ω –±–µ–∑ –≥—Ä–∞–Ω–∏—Ü</p>
            </div>

            <div class="auth-tabs">
                <button class="tab-btn active" data-tab="login">–í—Ö–æ–¥</button>
                <button class="tab-btn" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <!-- –í—Ö–æ–¥ -->
            <form id="login-form" class="auth-form active">
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                </div>
                <a href="#" id="forgot-password" class="forgot-link">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                <button type="submit" class="btn auth-btn">–í–æ–π—Ç–∏</button>

                <div class="divider">–∏–ª–∏</div>

                <button type="button" id="google-btn" class="btn google-btn">
                    <i class="fab fa-google"></i> –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
                </button>
            </form>

            <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
            <form id="register-form" class="auth-form">
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" name="email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)" required minlength="6">
                </div>
                <button type="submit" class="btn auth-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>

                <div class="divider">–∏–ª–∏</div>

                <button type="button" id="google-btn-reg" class="btn google-btn">
                    <i class="fab fa-google"></i> –ß–µ—Ä–µ–∑ Google
                </button>
            </form>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è -->
        <div id="reset-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h3>
                <form id="reset-form">
                    <div class="input-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" name="resetEmail" placeholder="–í–∞—à email" required>
                    </div>
                    <button type="submit" class="btn auth-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ</button>
                </form>
            </div>
        </div>

        <!-- –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loading-spinner" class="spinner">
            <div class="spinner-circle"></div>
        </div>
    </main>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
                document.getElementById(btn.dataset.tab + '-form').classList.add('active');
            });
        });

        // Google –∫–Ω–æ–ø–∫–∞ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–¥—É–±–ª–∏—Ä—É–µ–º)
        document.getElementById('google-btn-reg')?.addEventListener('click', () => document.getElementById('google-btn').click());

        // –ú–æ–¥–∞–ª–∫–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
        document.getElementById('forgot-password').addEventListener('click', e => {
            e.preventDefault();
            document.getElementById('reset-modal').style.display = 'block';
        });
        document.querySelector('.close').addEventListener('click', () => {
            document.getElementById('reset-modal').style.display = 'none';
        });
        window.addEventListener('click', e => {
            if (e.target === document.getElementById('reset-modal')) {
                document.getElementById('reset-modal').style.display = 'none';
            }
        });
    </script>
</body>
</html>
