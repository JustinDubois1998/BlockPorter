<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BlockPorter — Профиль</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="icon" href="logo.svg" type="image/svg+xml"/>
</head>
<body class="profile-body">
  <header class="header">
    <div class="container">
      <a href="index.html" class="logo">
        <img src="logo.svg" alt="BlockPorter" height="36"/>
      </a>
      <nav class="nav">
        <a href="index.html">Главная</a>
        <a href="dashboard.html">Обмен</a>
        <a href="about.html">О проекте</a>
        <span id="auth-status">Профиль</span>
      </nav>
    </div>
  </header>

  <main class="profile-main">
    <div class="profile-card glass">
      <div class="profile-header">
        <div class="avatar">
          <i class="fas fa-wallet"></i>
        </div>
        <h1>Ваш кошелёк</h1>
      </div>

      <!-- Блок подключённого кошелька -->
      <div id="wallet-connected" style="display:none;">
        <div class="address-block">
          <div class="address-label">Адрес</div>
          <div class="address-value" id="full-address">—</div>
          <button id="copy-address" class="btn copy-btn">
            <i class="fas fa-copy"></i> Копировать адрес
          </button>
        </div>

        <button id="disconnect" class="btn logout-btn">
          <i class="fas fa-sign-out-alt"></i> Выйти
        </button>
      </div>

      <!-- Блок без подключения -->
      <div id="no-wallet" class="connect-prompt">
        <p>Подключите кошелёк, чтобы начать работу</p>
        <button id="connect-wallet" class="btn neon-btn">
          Подключить MetaMask
        </button>
      </div>
    </div>
  </main>

  <script>
    let currentAccount = null;

    // Загрузка состояния при открытии страницы
    function loadProfileState() {
      const connected = localStorage.getItem('walletConnected') === 'true';
      currentAccount = localStorage.getItem('walletAddress');

      if (connected && currentAccount) {
        document.getElementById('wallet-connected').style.display = 'block';
        document.getElementById('no-wallet').style.display = 'none';
        document.getElementById('full-address').textContent = currentAccount;
      } else {
        document.getElementById('wallet-connected').style.display = 'none';
        document.getElementById('no-wallet').style.display = 'block';
      }
    }

    // Подключение кошелька
    document.getElementById('connect-wallet').addEventListener('click', async () => {
      if (!window.ethereum) return alert('MetaMask не установлен');

      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        currentAccount = accounts[0].toLowerCase();

        localStorage.setItem('walletAddress', currentAccount);
        localStorage.setItem('walletConnected', 'true');

        loadProfileState();
      } catch (err) {
        alert('Ошибка подключения');
      }
    });

    // Копирование адреса
    document.getElementById('copy-address').addEventListener('click', () => {
      if (currentAccount) {
        navigator.clipboard.writeText(currentAccount);
        alert('Адрес скопирован!');
      }
    });

    // Выход — теперь полностью скрывает блок и показывает подключение
    document.getElementById('disconnect').addEventListener('click', () => {
      localStorage.clear();          // Полная очистка
      currentAccount = null;         // Сброс переменной
      loadProfileState();            // Перерисовка интерфейса
      // Можно добавить alert('Вы вышли из кошелька');
    });

    // Инициализация при загрузке
    loadProfileState();

    // Автообновление при смене аккаунта в MetaMask
    if (window.ethereum) {
      window.ethereum.on('accountsChanged', () => {
        loadProfileState();
      });
    }
  </script>
</body>
</html>
