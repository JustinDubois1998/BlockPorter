<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BlockPorter — Профиль</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="icon" href="logo.svg" type="image/svg+xml"/>
</head>
<body class="profile-body">
  <header class="header">
    <div class="container">
      <a href="index.html" class="logo">
        <img src="logo.svg" alt="BlockPorter" height="36"/>
      </a>
      <nav class="nav">
        <a href="index.html">Главная</a>
        <a href="dashboard.html">Обмен</a>
        <a href="about.html">О проекте</a>
        <span id="auth-status">Профиль</span>
      </nav>
    </div>
  </header>

  <main class="profile-main">
    <div class="profile-card glass">
      <div class="profile-header">
        <div class="avatar">
          <i class="fas fa-wallet"></i>
        </div>
        <h1>Ваш кошелёк</h1>
        <p class="status">Подключён</p>
      </div>

      <!-- Адрес кошелька -->
      <div class="address-block">
        <div class="address-label">Адрес</div>
        <div class="address-value" id="full-address">—</div>
        <button id="copy-address" class="btn copy-btn">
          <i class="fas fa-copy"></i> Копировать адрес
        </button>
      </div>

      <!-- Кнопка выхода -->
      <button id="disconnect" class="btn logout-btn">
        <i class="fas fa-sign-out-alt"></i> Выйти
      </button>

      <!-- Если не подключён -->
      <div id="no-wallet" class="connect-prompt" style="display:none;">
        <p>Подключите кошелёк, чтобы начать</p>
        <button id="connect-wallet" class="btn neon-btn">
          Подключить MetaMask
        </button>
      </div>
    </div>
  </main>

  <script>
    let currentAccount = null;

    // Проверка при загрузке
    if (localStorage.getItem('walletConnected') === 'true') {
      currentAccount = localStorage.getItem('walletAddress');
      document.getElementById('full-address').textContent = currentAccount;
      document.getElementById('no-wallet').style.display = 'none';
    } else {
      document.getElementById('no-wallet').style.display = 'block';
    }

    // Подключение кошелька (если не подключён)
    document.getElementById('connect-wallet')?.addEventListener('click', async () => {
      if (!window.ethereum) return alert('MetaMask не установлен');

      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        currentAccount = accounts[0].toLowerCase();

        localStorage.setItem('walletAddress', currentAccount);
        localStorage.setItem('walletConnected', 'true');

        document.getElementById('full-address').textContent = currentAccount;
        document.getElementById('no-wallet').style.display = 'none';
      } catch (err) {
        alert('Ошибка подключения');
      }
    });

    // Копирование адреса
    document.getElementById('copy-address').addEventListener('click', () => {
      if (currentAccount) {
        navigator.clipboard.writeText(currentAccount);
        alert('Адрес скопирован в буфер обмена!');
      }
    });

    // Выход — работает 100%
    document.getElementById('disconnect').addEventListener('click', () => {
      localStorage.clear(); // Полностью очищаем все данные
      window.location.reload(); // Перезагружаем страницу
    });
  </script>
</body>
</html>
